---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-egress-to-cluster
  namespace: coder-v2  # Replace with your target namespace
spec:
  podSelector:
    matchLabels:
      "coder-v2": "true"
  policyTypes:
    - Egress
  egress:
    # Allow DNS traffic to the DNS service
    - to:
        - ipBlock:
            cidr: 10.43.0.10/32
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.99.0/24
              - 10.0.88.0/24
              - 10.0.100.0/24
              - 192.168.1.0/24
              - 192.168.89.0/24
              - 192.168.88.0/24
